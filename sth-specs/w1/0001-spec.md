# Ticket 标签管理工具需求和设计文档

## 1. 项目概述

本项目旨在构建一个简单易用的 Ticket 管理工具，支持通过标签对 Ticket 进行分类和管理。系统采用前后端分离架构，后端基于 FastAPI 和 PostgreSQL，前端使用 vue3 TypeScript、Vite、UnoCSS 和 Shadcn UI 组件库。

## 2. 需求分析

### 2.1 功能需求

#### 2.1.1 Ticket 管理
- **创建 Ticket**：用户可以创建新的 Ticket，包含标题、描述、标签等信息
- **编辑 Ticket**：用户可以修改已有 Ticket 的标题、描述和标签
- **删除 Ticket**：用户可以删除不再需要的 Ticket
- **完成 Ticket**：用户可以将标记为已完成状态
- **取消完成 Ticket**：用户可以将已完成的 Ticket 恢复为未完成状态

#### 2.1.2 标签管理
- **添加标签**：用户可以为 Ticket 添加新的标签
- **删除标签**：用户可以移除 Ticket 上的标签
- **标签分类**：系统自动维护所有已使用的标签列表

#### 2.1.3 搜索和筛选
- **按标签筛选**：用户可以根据标签查看相关的 Ticket 列表
- **按标题搜索**：用户可以通过关键词搜索 Ticket 标题

#### 2.1.4 数据展示
- **Ticket 列表**：以列表形式展示所有 Ticket，包含基本信息和状态
- **标签云**：展示所有已使用的标签及其使用频率

### 2.2 非功能需求

#### 2.2.1 性能需求
- 页面响应时间 ≤ 200ms
- 支持同时在线用户数 ≥ 100
- 数据库查询响应时间 ≤ 50ms

#### 2.2.2 易用性需求
- 界面简洁直观，符合现代 Web 设计标准
- 操作流程清晰，无需培训即可上手
- 支持响应式设计，适配不同设备屏幕

#### 2.2.3 可维护性需求
- 代码结构清晰，遵循模块化设计原则
- 提供详细的 API 文档和代码注释
- 支持单元测试和集成测试

## 3. 系统设计

### 3.1 架构设计

```
┌─────────────────┐    HTTP/JSON    ┌─────────────────┐
│   前端应用      │ ◄──────────────► │   后端 API      │
│ (TypeScript)    │                  │  (FastAPI)      │
└─────────────────┘                  └─────────────────┘
                                          │
                                          │ SQL
                                          ▼
                                    ┌─────────────────┐
                                    │  PostgreSQL     │
                                    │   数据库        │
                                    └─────────────────┘
```

### 3.2 技术栈选择

| 层级       | 技术选型                  | 版本号       | 理由                                  |
|------------|---------------------------|--------------|---------------------------------------|
| 前端框架   | vue3 + TypeScript        | 3.5.26 + 5.9.3 | 类型安全、组件化开发、生态丰富        |
| 构建工具   | Vite                      | 8.0.0        | 快速构建、热更新、开箱即用            |
| UI 框架    | element-plus + UnoCSS     | 2.13.0 + 0.60.2 | 美观的组件库、原子化 CSS、灵活定制    |
| 后端框架   | FastAPI                   | 0.115.0      | 高性能、自动文档、类型安全            |
| 数据库     | PostgreSQL                | 17.0         | 强大的关系型数据库、支持 JSON 类型    |
| ORM 框架   | SQLAlchemy                | 2.0.36       | 成熟的 Python ORM、支持异步操作       |
| API 文档   | Swagger UI                | 6.5.0        | 自动生成、交互式测试                  |

## 4. 数据库设计

### 4.1 实体关系图

```
┌─────────────┐       ┌─────────────┐       ┌─────────────┐
│   Ticket    │       │  TicketTag  │       │    Tag      │
├─────────────┤       ├─────────────┤       ├─────────────┤
│ id (PK)     │───┐   │ id (PK)     │   ┌───┤ id (PK)     │
│ title       │   │   │ ticket_id   │◄──┘   │ name        │
│ description │   └──►│ tag_id      │◄──┐   │ color       │
│ is_completed│       │ created_at  │   │   │ created_at  │
│ created_at  │       └─────────────┘   │   └─────────────┘
│ updated_at  │                          │
└─────────────┘                          │
                                         │
                                         └──────────────────────────┐
                                                                    │
┌─────────────┐       ┌─────────────┐       ┌─────────────┐        │
│   User      │       │  Session    │       │   Log       │        │
├─────────────┤       ├─────────────┤       ├─────────────┤        │
│ id (PK)     │       │ id (PK)     │       │ id (PK)     │        │
│ username    │       │ user_id     │       │ user_id     │        │
│ password    │       │ token       │       │ action      │        │
│ created_at  │       │ expires_at  │       │ timestamp   │        │
└─────────────┘       └─────────────┘       └─────────────┘        │
                                                                    │
                                                                    ▼
                                                              ┌─────────────┐
                                                              │  多对多关系  │
                                                              └─────────────┘
```

### 4.2 表结构设计

#### 4.2.1 tickets 表

| 字段名        | 类型         | 约束         | 描述                     |
|---------------|--------------|--------------|--------------------------|
| id            | UUID         | PRIMARY KEY  | Ticket 唯一标识符        |
| title         | VARCHAR(255) | NOT NULL     | Ticket 标题              |
| description   | TEXT         |              | Ticket 详细描述          |
| is_completed  | BOOLEAN      | DEFAULT false | Ticket 完成状态          |
| created_at    | TIMESTAMP    | DEFAULT now() | 创建时间                 |
| updated_at    | TIMESTAMP    | DEFAULT now() | 更新时间                 |

#### 4.2.2 tags 表

| 字段名        | 类型         | 约束         | 描述                     |
|---------------|--------------|--------------|--------------------------|
| id            | UUID         | PRIMARY KEY  | 标签唯一标识符           |
| name          | VARCHAR(50)  | NOT NULL UNIQUE | 标签名称              |
| color         | VARCHAR(7)   | DEFAULT '#0070f3' | 标签颜色（十六进制） |
| created_at    | TIMESTAMP    | DEFAULT now() | 创建时间                 |

#### 4.2.3 ticket_tags 表

| 字段名        | 类型         | 约束         | 描述                     |
|---------------|--------------|--------------|--------------------------|
| id            | UUID         | PRIMARY KEY  | 关联记录唯一标识符       |
| ticket_id     | UUID         | FOREIGN KEY  | 关联的 Ticket ID         |
| tag_id        | UUID         | FOREIGN KEY  | 关联的 Tag ID            |
| created_at    | TIMESTAMP    | DEFAULT now() | 创建时间                 |

### 4.3 数据库表创建脚本

```sql
-- 创建扩展以支持 UUID
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- 创建 tickets 表
CREATE TABLE tickets (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    title VARCHAR(255) NOT NULL,
    description TEXT,
    is_completed BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 创建 tags 表
CREATE TABLE tags (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(50) NOT NULL UNIQUE,
    color VARCHAR(7) DEFAULT '#0070f3',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 创建 ticket_tags 关联表
CREATE TABLE ticket_tags (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    ticket_id UUID NOT NULL,
    tag_id UUID NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ticket_id) REFERENCES tickets(id) ON DELETE CASCADE,
    FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE,
    UNIQUE (ticket_id, tag_id)
);

-- 创建索引以优化查询性能
CREATE INDEX idx_tickets_created_at ON tickets(created_at);
CREATE INDEX idx_tickets_is_completed ON tickets(is_completed);
CREATE INDEX idx_ticket_tags_ticket_id ON ticket_tags(ticket_id);
CREATE INDEX idx_ticket_tags_tag_id ON ticket_tags(tag_id);

-- 创建触发器自动更新 updated_at 字段
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_tickets_updated_at
BEFORE UPDATE ON tickets
FOR EACH ROW
EXECUTE FUNCTION update_updated_at_column();
```

## 5. API 设计

### 5.1 基础路径

所有 API 接口都以 `/api/v1` 作为基础路径。返回为json格式。

### 5.2 通用返回状态码

| 状态码 | 含义                     | 说明                                  |
|--------|--------------------------|---------------------------------------|
| 200    | OK                       | 请求成功                              |
| 400    | Bad Request              | 请求参数错误或格式不正确              |
| 401    | Unauthorized             | 未授权访问                            |
| 403    | Forbidden                | 权限不足                              |
| 404    | Not Found                | 请求资源不存在                        |
| 405    | Method Not Allowed       | 请求方法不支持                        |
| 409    | Conflict                 | 资源冲突（如重复创建）                |
| 500    | Internal Server Error    | 服务器内部错误                        |
| 502    | Bad Gateway              | 网关错误                              |
| 503    | Service Unavailable      | 服务不可用                            |

### 5.3 通用返回格式

所有 API 接口返回统一的 JSON 格式：

```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": 1766324581000
}
```

| 字段名     | 类型   | 说明                     |
|------------|--------|--------------------------|
| code       | 整数   | 状态码，对应上述状态码列表 |
| message    | 字符串 | 响应消息                 |
| data       | 对象   | 响应数据，可为 null      |
| timestamp  | 整数   | 响应时间戳（毫秒）        |

### 5.4 Ticket 相关接口

#### 5.4.1 创建 Ticket

```http
POST /api/v1/addTickets
Content-Type: application/json

{
  "title": "修复登录页面样式问题",
  "description": "登录按钮在移动端显示不全",
  "tags": ["前端", "样式"]
}
```

**返回示例（200 Created）：**
```json
{
  "code": 200,
  "message": "Ticket 创建成功",
  "data": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": 1766324581000
}
```

#### 5.4.2 获取 Ticket 列表

```http
GET /api/v1/listTickets?tag=前端&search=登录
```

**返回示例（200 OK）：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "tickets": [
      {
        "id": "550e8400-e29b-41d4-a716-446655440000",
        "title": "修复登录页面样式问题",
        "description": "登录按钮在移动端显示不全",
        "is_completed": false,
        "created_at": "2025-01-01T00:00:00Z",
        "updated_at": "2025-01-01T00:00:00Z",
        "tags": [
          {"id": "tag1", "name": "前端", "color": "#0070f3"},
          {"id": "tag2", "name": "样式", "color": "#ff4560"}
        ]
      }
    ],
    "total": 1
  },
  "timestamp": 1766324581000
}
```

#### 5.4.3 获取单个 Ticket

```http
GET /api/v1/tickets/{ticket_id}
```

**返回示例（200 OK）：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "title": "修复登录页面样式问题",
    "description": "登录按钮在移动端显示不全",
    "is_completed": false,
    "created_at": "2025-01-01T00:00:00Z",
    "updated_at": "2025-01-01T00:00:00Z",
    "tags": [
      {"id": "tag1", "name": "前端", "color": "#0070f3"},
      {"id": "tag2", "name": "样式", "color": "#ff4560"}
    ]
  },
  "timestamp": 1766324581000
}
```

**错误示例（404 Not Found）：**
```json
{
  "code": 404,
  "message": "Ticket 不存在",
  "data": null,
  "timestamp": 1766324581000
}
```

#### 5.4.4 更新 Ticket

```http
PUT /api/v1/updateTickets/{ticket_id}
Content-Type: application/json

{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "title": "修复登录页面样式问题",
  "description": "登录按钮在移动端显示不全，已修复",
  "is_completed": true
}
```

**返回示例（200 OK）：**
```json
{
  "code": 200,
  "message": "Ticket 更新成功",
  "timestamp": 1766324581000
}
```

#### 5.4.5 删除 Ticket

```http
DELETE /api/v1/tickets/{ticket_id}
```

**返回示例（200 No Content）：**
```json
{
  "code": 200,
  "message": "Ticket 删除成功",
  "data": null,
  "timestamp": 1766324581000
}
```

### 5.5 标签相关接口

#### 5.5.1 获取所有标签

```http
GET /api/v1/listTags
```

**返回示例（200 OK）：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "tags": [
      {"id": "tag1", "name": "前端", "color": "#0070f3"},
      {"id": "tag2", "name": "后端", "color": "#2ecc71"},
      {"id": "tag3", "name": "样式", "color": "#ff4560"}
    ]
  },
  "timestamp": 1766324581000
}
```

#### 5.5.2 创建标签

```http
POST /api/v1/addTags
Content-Type: application/json

{
  "name": "后端",
  "color": "#2ecc71"
}
```

**返回示例（200 Created）：**
```json
{
  "code": 200,
  "message": "标签创建成功",
  "data": "tag2",
  "timestamp": 1766324581000
}
```

**错误示例（409 Conflict）：**
```json
{
  "code": 409,
  "message": "标签已存在",
  "data": null,
  "timestamp": 1766324581000
}
```

#### 5.5.3 为 Ticket 添加标签

```http
POST /api/v1/addTicketTags/{ticket_id}
Content-Type: application/json

{
  "tag_ids": ["tag1", "tag2"]
}
```

**返回示例（200 OK）：**
```json
{
  "code": 200,
  "message": "标签添加成功",
  "timestamp": 1766324581000
}
```

#### 5.5.4 为 Ticket 移除标签

```http
DELETE /api/v1/deleteTicketTags/{ticket_id}/{tag_id}
```

**返回示例（200 OK）：**
```json
{
  "code": 200,
  "message": "标签移除成功",
  "timestamp": 1766324581000
}
```

## 6. 前端设计

### 6.1 页面结构

#### 6.1.1 主页面布局

```
┌───────────────────────────────────────────────────┐
│  Header  │  搜索框  │  标签云  │  创建按钮          │
├──────────┼──────────┼──────────┼───────────────────┤
│          │          │          │                   │
│  侧边栏  │  主内容  │  侧边栏  │  Ticket 列表/详情  │
│  (标签)  │  (列表)  │  (筛选)  │                   │
│          │          │          │                   │
└──────────┴──────────┴──────────┴───────────────────┘
```

#### 6.1.2 页面组件

| 组件名称       | 功能描述                     |
|----------------|------------------------------|
| TicketList     | 展示 Ticket 列表             |
| TicketDetail   | 展示单个 Ticket 详细信息     |
| TicketForm     | 创建/编辑 Ticket 表单        |
| TagCloud       | 展示所有标签及其使用频率     |
| SearchBar      | 搜索 Ticket 标题             |
| FilterPanel    | 按标签筛选 Ticket            |

### 6.2 状态管理

采用 React Context + useReducer 实现全局状态管理，主要管理以下状态：
- 当前用户信息
- 所有标签列表
- 筛选条件
- 搜索关键词

### 6.3 数据交互

使用 Axios 作为 HTTP 客户端，封装 API 请求方法：

```typescript
// api/tickets.ts
export const getTickets = async (params: { tag?: string; search?: string }) => {
  const response = await axios.get('/api/v1/tickets', { params });
  return response.data;
};

export const createTicket = async (data: TicketCreateData) => {
  const response = await axios.post('/api/v1/tickets', data);
  return response.data;
};
```

## 7. 部署方案

### 7.1 开发环境部署

1. 安装依赖：
   ```bash
   # 后端
   cd backend
   pip install -r requirements.txt
   
   # 前端
   cd frontend
   pnpm install
   ```

2. 启动数据库：
   ```bash
   docker-compose up -d postgres
   ```

3. 启动后端服务：
   ```bash
   cd backend
   uvicorn main:app --reload --host 0.0.0.0 --port 8000
   ```

4. 启动前端服务：
   ```bash
   cd frontend
   npm run dev
   ```

### 7.2 生产环境部署

使用 Docker Compose 进行容器化部署：

```yaml
version: '3.8'
services:
  postgres:
    image: postgres:17
    environment:
      POSTGRES_USER: ticketadmin
      POSTGRES_PASSWORD: ticketpass
      POSTGRES_DB: ticketdb
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  backend:
    build: ./backend
    environment:
      DATABASE_URL: postgresql://ticketadmin:ticketpass@postgres:5432/ticketdb
    ports:
      - "8000:8000"
    depends_on:
      - postgres

  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    depends_on:
      - backend

volumes:
  postgres_data:
```

## 8. 测试计划

### 8.1 单元测试

- 后端：使用 pytest 编写单元测试，覆盖核心业务逻辑
- 前端：使用 Vitest + Vue Test Utils 编写组件测试

### 8.2 集成测试

- 测试 API 接口的正确性和稳定性
- 测试前后端数据交互的完整性

### 8.3 性能测试

- 使用 Locust 进行压力测试
- 测试系统在高并发情况下的响应时间

## 9. 项目进度

### 9.1 里程碑计划

| 阶段         | 时间范围 | 主要任务                     |
|--------------|----------|------------------------------|
| 需求分析     | 第 1 周  | 完成需求文档和设计文档       |
| 后端开发     | 第 2-3 周 | 完成 API 接口开发和数据库设计 |
| 前端开发     | 第 4-5 周 | 完成前端页面和交互功能       |
| 测试和优化   | 第 6 周  | 完成单元测试和性能优化       |
| 部署上线     | 第 7 周  | 完成生产环境部署和文档编写   |

### 9.2 风险评估

| 风险项         | 可能性 | 影响程度 | 应对措施                     |
|----------------|--------|----------|------------------------------|
| 需求变更       | 高     | 中       | 建立变更管理流程，及时沟通   |
| 技术难点       | 中     | 高       | 提前进行技术调研，预留缓冲时间 |
| 人员变动       | 低     | 高       | 建立知识共享机制，文档化流程 |

## 10. 附录

### 10.1 术语表

| 术语       | 定义                     |
|------------|--------------------------|
| Ticket     | 工单，系统中的基本任务单元 |
| Tag        | 标签，用于分类和筛选 Ticket |
| API        | 应用程序编程接口          |
| ORM        | 对象关系映射              |

### 10.2 参考资料

- [FastAPI 官方文档](https://fastapi.tiangolo.com/)
- [React 官方文档](https://react.dev/)
- [PostgreSQL 官方文档](https://www.postgresql.org/docs/)
- [Shadcn UI 文档](https://ui.shadcn.com/)
- [UnoCSS 文档](https://unocss.dev/)

---
**版本历史**

| 版本 | 日期       | 作者       | 变更描述                     |
|------|------------|------------|------------------------------|
| 1.0  | 2025-01-01 | 开发团队   | 初始版本                     |